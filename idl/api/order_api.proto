syntax = "proto3";

package gateway.order;

import "api.proto";

option go_package = "/api/order";

message OrderItem {
  uint64 sku_id = 1;
  string sku_name = 2;
  int32 quantity = 3;
  string price = 4;
}

message AddressDTO {
  string name = 1;
  string street_address = 2;
  string city = 3;
  int32 zip_code = 4;
}

message OrderResultDTO {
  string order_id = 1;
}

message OrderDTO {
  string order_id = 1;
  uint64 user_id = 2;
  repeated OrderItem items = 3;
  string status = 4;
  AddressDTO shipping_address = 5;
  int32 created_at = 6;
}

// 下单请求
message PlaceOrderReq {
  string email = 1 [(api.body) = "email"];
  AddressDTO shipping_address = 2 [(api.body) = "shipping_address"];
}

message PlaceOrderResp {
  OrderResultDTO order = 1;
}

// 获取订单
// message GetOrderReq {
//   string order_id = 1 [(api.path) = "order_id"];
// }

// message GetOrderResp {
//   OrderDTO order = 1;
// }

// 列表订单
message ListOrderReq {
}

message ListOrderResp {
  repeated OrderDTO orders = 1;
}

// 取消订单
message CancelOrderReq {
  string order_id = 1 [(api.path) = "order_id"];
}

message CancelOrderResp {
  bool success = 1;
}

// // 标记已支付
// message MarkOrderPaidReq {
//   string order_id = 1 [(api.body) = "order_id"];
//   string transaction_id = 2 [(api.body) = "transaction_id"];
//   string paid_amount = 3 [(api.body) = "paid_amount"];
// }

// message MarkOrderPaidResp {
//   bool success = 1;
// }

// Gateway Order Service
service OrderService {
  // 下单
  rpc PlaceOrder(PlaceOrderReq) returns (PlaceOrderResp) {
    option (api.post) = "/orders";
  }
//   // 获取订单
//   rpc GetOrder(GetOrderReq) returns (GetOrderResp) {
//     option (api.get) = "/orders/:order_id";
//   }
  // 列出用户订单
  rpc ListOrder(ListOrderReq) returns (ListOrderResp) {
    option (api.get) = "/orders";
  }
  // 取消订单
  rpc CancelOrder(CancelOrderReq) returns (CancelOrderResp) {
    option (api.post) = "/orders/:order_id/cancel";
  }

//   rpc MarkOrderPaid(MarkOrderPaidReq) returns (MarkOrderPaidResp) {
//     option (api.post) = "/orders/:order_id/paid";
//   }
}
